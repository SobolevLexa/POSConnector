var POSConnector=function(){"use strict";var r={},i="POSConnector",c=0,s={},a=[],t="GetLoginInformation",o="GetLoginInformationCallback",u="PayBasket",f="PayBasketCallback",l="BarcodeScanned",d="DeeplinkActivated",p="OpenURL",b="OpenURLCallback",v="PrintDocumentAtURL",y="PrintDocumentWithData",m="PrintDocumentCallback",k="SendPOSConnectorObjectPathToPOS",P="SendPOSConnectorObjectPathToPOSCallback",g="basket",C="url",w="data",h="objectPath";function O(e,n){var t={};return t.type=e,t.listenerCallback=n,t}function S(e,n,t){if("function"==typeof n){var a=c;return s[a]=n,c+=1,new S(e,a,t)}var o={};return o.name=e,o.callbackId=n,o.body=t,o}function I(e,n){"function"==typeof e&&e.apply(void 0,n)}function D(e){if(!r.isConnected())return"No connection is established from the native POS application";var n,t,a,o=(t=(n=e).split("."),a=window,t.some(function(e){if(!a.hasOwnProperty(e)||"object"!=typeof a[e])return!0;a=a[e]})?"Invalid component(s) in object path: "+n:"function"!=typeof a.receiveMessage?"Invalid POSConnector object at the end of object path: "+n:void 0);return"string"==typeof o?o:void 0}function n(e){if("number"==typeof e){var n=s[e];return delete s[e],n}}function E(e){window.webkit.messageHandlers.POS.postMessage(e)}function j(e){I(n(e.callbackId),[e.body.result,e.body.error])}function L(e){I(n(e.callbackId),[e.body.error])}r.receiveMessage=function(e){switch(e.name){case l:t=e.body,a.forEach(function(e){e.type===r.EventType.BarcodeScanned&&e.listenerCallback(t)});break;case d:n=e.body,a.forEach(function(e){e.type===r.EventType.DeeplinkActivated&&e.listenerCallback(n)});break;case o:case f:j(e);break;case b:L(e);break;case m:j(e);break;case P:L(e)}var n,t},r.LineItem=function(e,n,t,a,o,r,i,c){var s={};return s.name=e,s.quantity=n,s.unitPrice=t,s.vatPercentage=a,s.salesTaxPercentage=o,s.productId=r,s.imei=i,s.discounts=c,s};r.TransactionType={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Point:"Point"},r.Transaction=function(e,n){var t={};return t.transactionType=e,t.amount=n,t},r.Discount=function(e,n,t){var a={};return a.description=e,a.amount=n,a.percentage=t,a},r.Basket=function(e,n,t,a){var o={};return o.id=e,o.lineItems=n,o.transactions=t,o.discounts=a,o},r.LoginInformation=function(e,n,t,a,o,r){var i={};return i.shopId=e,i.shopName=n,i.registerId=t,i.registerName=a,i.userId=o,i.userName=r,i};return r.EventType={BarcodeScanned:"BarcodeScanned",DeeplinkActivated:"DeeplinkActivated"},r.addEventListener=function(e,n){a.push(new O(e,n))},r.removeEventListener=function(t){a.forEach(function(e,n){e.listenerCallback===t&&a.splice(n,1)})},r.isConnected=function(){return"object"==typeof window.webkit&&"object"==typeof window.webkit.messageHandlers&&"object"==typeof window.webkit.messageHandlers.POS},r.payBasket=function(e,n){var t=D(i);if("string"!=typeof t){var a={};a[g]=e,E(new S(u,n,a))}else I(n,[!1,t])},r.getLoginInformation=function(e){var n=D(i);"string"!=typeof n?E(new S(t,e)):I(e,[null,n])},r.openURL=function(e,n){var t=D(i);if("string"!=typeof t){var a={};a[C]=e,E(new S(p,n,a))}else I(n,[t])},r.printDocumentAtURL=function(e,n){var t=D(i);if("string"!=typeof t){var a={};a[C]=e,E(new S(v,n,a))}else I(n,[!1,t])},r.printDocumentWithData=function(e,t){var n=D(i);if("string"!=typeof n){var a=function(e){var n={};n[w]=e,E(new S(y,t,n))},o=typeof e;if("string"!==o&&"object"!==o&&I(t,[!1,"Data argument of invalid type: "+o]),"string"!==o){var r=new FileReader;r.onload=function(){var e=r.result,n=e.substr(e.indexOf(",")+1);a(n)},r.readAsDataURL(e)}else a(e)}else I(t,[n])},r.sendPOSConnectorObjectPathToPOS=function(n,t){var e=D(n);if("string"!=typeof e){var a={};a[h]=n,E(new S(k,function(e){"string"==typeof e&&I(t,[e]),i=n,I(t)},a))}else I(t,[e])},r}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);