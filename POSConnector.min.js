var POSConnector,POSConnectorClass;POSConnectorClass=function(){function e(){var e;this._bridge=null,e=this,this._connectWebViewJavascriptBridge(function(t){return e._bridge=t,e._bridge.init(function(){})})}return e.prototype.isConnected=function(){return null!=this._bridge},e.prototype.payBasket=function(e,t){return this._validateOrder(e).length||this._callHandler("payBasket",e),t?t(this._validateOrder(e)):void 0},e.prototype.subscribeForPaymentStatus=function(e){return this._registerHandler("paymentStatus",e)},e.prototype.subscribeForBarcodeScan=function(e){return this._registerHandler("barcodeScan",e)},e.prototype._connectWebViewJavascriptBridge=function(e){return window.WebViewJavascriptBridge?e(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){return e(WebViewJavascriptBridge)},!1)},e.prototype._sendMessage=function(e,t){return t?this._bridge.send(e,t):this._bridge.send(e)},e.prototype._registerHandler=function(e,t){return this._bridge.registerHandler(e,t)},e.prototype._callHandler=function(e,t){return this._bridge.callHandler(e,t)},e.prototype._validateOrder=function(e){var t,n,r,i,a,o,s,c,d,u,p,m,l,g,f,_,h,v,b;if(i=[],o=function(e){var t;return t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/),t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0},c=function(e){return"number"==typeof e&&o(e)<=2},a=function(e,t){return i.push({errorCode:e,message:t})},e.id||a(1,"Order ID must be present"),(!e.order_line_items||e.order_line_items.length<1)&&a(2,"Order must containt at least 1 OrderLineItem"),e.order_line_items)for(_=e.order_line_items,s=0,m=_.length;m>s;s++)if(n=_[s],n.quantity&&0!==n.quantity||a(3,"Each OrderLineItem must contain a quantity different than 0"),n.unit_price&&c(n.unit_price)||a(4,"Each OrderLineItem must contain unit price with max 2 decimals"),n.product_id&&"string"==typeof n.product_id&&""!==n.product_id||a(5,"Each OrderLineItem must contain a name"),n.vat_percentage&&n.vat_percentage>=0&&n.vat_percentage<=1||a(6,"Each OrderLineItem must contain a vat rate from 0 to 1"),!n.imei||"string"==typeof n.imei&&""!==n.imei||a(7,"If imei is present on OrderLineItem, it must of type string and non empty"),n.discounts)for(h=n.discounts,d=0,l=h.length;l>d;d++)t=h[d],t.amount&&c(t.amount)||a(8,"Each discount must contain amount with max 2 decimals"),!t.percentage||t.percentage>=0&&t.percentage<=1||a(9,"If percentage is present on Discount, it must be from 0 to 1"),!t.description||"string"==typeof t.description&&""!==t.description||a(10,"If description is present on Discount, it must be a non empty string");if(e.discounts)for(v=e.discounts,u=0,g=v.length;g>u;u++)t=v[u],t.amount&&c(t.amount)||a(8,"Each discount must contain amount with max 2 decimals"),!t.percentage||t.percentage>=0&&t.percentage<=1||a(9,"If percentage is present on Discount, it must be from 0 to 1"),!t.description||"string"==typeof t.description&&""!==t.description||a(10,"If description is present on Discount, it must be a non empty string");if(e.transactions)for(b=e.transactions,p=0,f=b.length;f>p;p++)r=b[p],r.type&&"WM_TRANSACTION_TYPE_INSTALLMENT"===r.type||a(11,'Each transaction must contain type matching "WM_TRANSACTION_TYPE_INSTALLMENT"'),r.amount&&c(r.amount)||a(12,"Each transaction must contain amount with max 2 decimals");return i},e.prototype.simulatePos=function(){var e,t,n,r,i,a,o,s,c,d,u,p,m,l,g,f,_,h,v;return o=void 0,m=[],c=[],a={},e="wvjbscheme",t="__WVJB_QUEUE_MESSAGE__",u={},l=1,g=function(n){return o=n.createElement("iframe"),o.style.display="none",o.src=e+"://"+t,n.documentElement.appendChild(o)},i=function(e){var t,n,r;if(WebViewJavascriptBridge._messageHandler)throw new Error("WebViewJavascriptBridge.init called twice");for(WebViewJavascriptBridge._messageHandler=e,n=c,c=null,t=0,r=[];t<n.length;)f(n[t]),r.push(t++);return r},p=function(e,t){return _({data:e},t)},d=function(e,t){return a[e]=t},n=function(e,t,n){return _({handlerName:e,data:t},n)},_=function(n,r){var i;return r&&(i="cb_"+l++ +"_"+(new Date).getTime(),u[i]=r,n.callbackId=i),m.push(n),o.src=e+"://"+t,n.handlerName?(console.log("[POS]: Received handler("+n.handlerName+")",n.data),console.log("POS invoking paymentStatus event in 10 seconds."),a.paymentStatus?setTimeout(function(){return a.paymentStatus({status:1,one_screen_order_id:n.data.id})},1e4):void 0):console.log("[POS]: Received message: ",n.data)},h=function(){var e;return e=JSON.stringify(m),m=[],e},f=function(e){var t;return setTimeout(t=function(){var t,n,r,i,o,s;if(i=JSON.parse(e),o=void 0,i.responseId){if(s=u[i.responseId],!s)return;return s(i.responseData),delete u[i.responseId]}s=void 0,i.callbackId&&(t=i.callbackId,s=function(e){return _({responseId:t,responseData:e})}),r=WebViewJavascriptBridge._messageHandler,i.handlerName&&(r=a[i.handlerName]);try{return r(i.data,s)}catch(c){if(n=c,"undefined"!=typeof console)return console.log("WebViewJavascriptBridge: WARNING: javascript handler threw.",i,n)}})},v=function(e){return c?c.push(e):f(e)},window.WebViewJavascriptBridge?void 0:(window.WebViewJavascriptBridge={init:i,send:p,registerHandler:d,callHandler:n,_fetchQueue:h,_handleMessageFromObjC:v},r=document,g(r),s=r.createEvent("Events"),s.initEvent("WebViewJavascriptBridgeReady"),s.bridge=WebViewJavascriptBridge,r.dispatchEvent(s))},e}(),POSConnector=new POSConnectorClass;