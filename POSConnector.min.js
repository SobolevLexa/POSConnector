var POSConnector=function(){"use strict";function n(n,e){var t={};return t.type=n,t.listenerCallback=e,t}function e(n,t,o){if("function"==typeof t)return void 0===s?s=0:s+=1,u[s]=t,new e(n,s,o);var a={};return a.name=n,a.callbackId=t,a.body=o,a}function t(n){if(void 0!==n&&null!==n){var e=u[n];return delete u[n],e}}function o(n){console.log("sendMessage: "+n),window.webkit.messageHandlers.POS.postMessage(n)}function a(n){var e=t(n.callbackId);if(e){var o=n.body.result,a=n.body.error;e(o,a)}}function r(n){var e=t(n.callbackId);if(e){var o=n.body.error;e(o)}}function i(){d.forEach(function(n){n.type===l.EventType.ConnectionEstablished&&n.listenerCallback()})}function c(n){var e=n.body;d.forEach(function(n){n.type===l.EventType.BarcodeScanned&&n.listenerCallback(e)})}var s,l={},u={},d=[],f={ConnectionEstablished:"ConnectionEstablished",GetLoginInformation:"GetLoginInformation",GetLoginInformationCallback:"GetLoginInformationCallback",PayBasket:"PayBasket",PayBasketCallback:"PayBasketCallback",BarcodeScanned:"BarcodeScanned",OpenURL:"OpenURL",OpenURLCallback:"OpenURLCallback",PrintDocumentAtURL:"PrintDocumentAtURL",PrintDocumentCallback:"PrintDocumentCallback"},b={Result:"result",Error:"error",LoginInformation:"loginInformation",Basket:"basket",URL:"url"},m={NotConnected:"No connection is established from the native POS application"};return l.receiveMessage=function(n){switch(console.log("receiveMessage: "+n),n.name){case f.ConnectionEstablished:i();break;case f.BarcodeScanned:c(n);break;case f.GetLoginInformationCallback:a(n);break;case f.PayBasketCallback:a(n);break;case f.OpenURLCallback:r(n);break;case f.PrintDocumentCallback:a(n);break;default:console.log("Unknown message name: "+n.name)}},l.LineItem=function(n,e,t,o,a,r,i,c){var s={};return s.name=n,s.quantity=e,s.unitPrice=t,s.vatPercentage=o,s.salesTaxPercentage=a,s.productId=r,s.imei=i,s.discounts=c,s},l.TransactionType={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Point:"Point"},l.Transaction=function(n,e){var t={};return t.transactionType=n,t.amount=e,t},l.Discount=function(n,e,t){var o={};return o.description=n,o.amount=e,o.percentage=t,o},l.Basket=function(n,e,t,o){var a={};return a.id=n,a.lineItems=e,a.transactions=t,a.discounts=o,a},l.LoginInformation=function(n,e,t,o,a,r){var i={};return i.shopId=n,i.shopName=e,i.registerId=t,i.registerName=o,i.userId=a,i.userName=r,i},l.EventType={ConnectionEstablished:"ConnectionEstablished",BarcodeScanned:"BarcodeScanned"},l.addEventListener=function(e,t){var o=[e,t];console.log("addEventListener: "+o.join(", ")),d.push(new n(e,t))},l.removeEventListener=function(n){console.log("removeEventListener: "+n),d.forEach(function(e,t){e.listenerCallback===n&&d.splice(t,1)})},l.isConnected=function(){return void 0!==window.webkit&&void 0!==window.webkit.messageHandlers&&void 0!==window.webkit.messageHandlers.POS},l.payBasket=function(n,t){var a=[n,t];if(console.log("payBasket: "+a.join(", ")),!l.isConnected())return void t(!1,m.NotConnected);var r={};r[b.Basket]=n;var i=new e(f.PayBasket,t,r);o(i)},l.getLoginInformation=function(n){if(console.log("getLoginInformation: "+n),!l.isConnected())return void n(null,m.NotConnected);var t=new e(f.GetLoginInformation,n);o(t)},l.openURL=function(n,t){var a=[n,t];console.log("openURL: "+a.join(", "));var r={};r[b.URL]=n;var i=new e(f.OpenURL,t,r);o(i)},l.printDocumentAtURL=function(n,t){var a=[n,t];console.log("printDocumentAtURL: "+a.join(", "));var r={};r[b.URL]=n;var i=new e(f.PrintDocumentAtURL,t,r);o(i)},l}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);