var POSConnector=function(){"use strict";function n(n,e){var a={};return a.type=n,a.listenerCallback=e,a}function e(n,a,o){if("function"==typeof a)return void 0===l?l=0:l+=1,u[l]=a,new e(n,l,o);var t={};return t.name=n,t.callbackId=a,t.body=o,t}function a(n){if(void 0!==n&&null!==n){var e=u[n];return delete u[n],e}}function o(n){console.log("sendMessage: "+n),window.webkit.messageHandlers.POS.postMessage(n)}function t(){f.forEach(function(n){n.type===d.EventType.ConnectionEstablished&&n.listenerCallback()})}function r(n){var e=n.body;f.forEach(function(n){n.type===d.EventType.BarcodeScanned&&n.listenerCallback(e)})}function i(n){var e=a(n.callbackId);if(e){var o=n.body.result,t=n.body.error;e(o,t)}}function c(n){var e=a(n.callbackId);if(e){var o=n.body.success,t=n.body.error;e(o,t)}}function s(n){var e=a(n.callbackId);if(e){var o=n.body.error;e(o)}}var l,d={},u={},f=[],b={ConnectionEstablished:"ConnectionEstablished",GetLoginInformation:"GetLoginInformation",GetLoginInformationCallback:"GetLoginInformationCallback",PayBasket:"PayBasket",PayBasketCallback:"PayBasketCallback",BarcodeScanned:"BarcodeScanned",OpenURL:"OpenURL",OpenURLCallback:"OpenURLCallback"},v={Result:"result",Error:"error",Success:"success",LoginInformation:"loginInformation",Basket:"basket",URL:"url"},k={NotConnected:"No connection is established from the native POS application"};return d.receiveMessage=function(n){switch(console.log("receiveMessage: "+n),n.name){case b.ConnectionEstablished:t();break;case b.BarcodeScanned:r(n);break;case b.GetLoginInformationCallback:i(n);break;case b.PayBasketCallback:c(n);break;case b.OpenURLCallback:s(n);break;default:console.log("Unknown message name: "+n.name)}},d.LineItem=function(n,e,a,o,t,r,i,c){var s={};return s.name=n,s.quantity=e,s.unitPrice=a,s.vatPercentage=o,s.salesTaxPercentage=t,s.productId=r,s.imei=i,s.discounts=c,s},d.TransactionType={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Point:"Point"},d.Transaction=function(n,e){var a={};return a.transactionType=n,a.amount=e,a},d.Discount=function(n,e,a){var o={};return o.description=n,o.amount=e,o.percentage=a,o},d.Basket=function(n,e,a,o){var t={};return t.id=n,t.lineItems=e,t.transactions=a,t.discounts=o,t},d.LoginInformation=function(n,e,a,o,t,r){var i={};return i.shopId=n,i.shopName=e,i.registerId=a,i.registerName=o,i.userId=t,i.userName=r,i},d.EventType={ConnectionEstablished:"ConnectionEstablished",BarcodeScanned:"BarcodeScanned"},d.addEventListener=function(e,a){var o=[e,a];console.log("addEventListener: "+o.join(", ")),f.push(new n(e,a))},d.removeEventListener=function(n){console.log("removeEventListener: "+n),f.forEach(function(e,a){e.listenerCallback===n&&f.splice(a,1)})},d.isConnected=function(){return void 0!==window.webkit&&void 0!==window.webkit.messageHandlers&&void 0!==window.webkit.messageHandlers.POS},d.payBasket=function(n,a){var t=[n,a];if(console.log("payBasket: "+t.join(", ")),!d.isConnected())return void a(!1,k.NotConnected);var r={};r[v.Basket]=n;var i=new e(b.PayBasket,a,r);o(i)},d.getLoginInformation=function(n){if(console.log("getLoginInformation: "+n),!d.isConnected())return void n(null,k.NotConnected);var a=new e(b.GetLoginInformation,n);o(a)},d.openURL=function(n,a){var t=[n,a];console.log("openURL: "+t.join(", "));var r={};r[v.URL]=n;var i=new e(b.OpenURL,a,r);o(i)},d}();