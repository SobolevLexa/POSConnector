var POSConnector=function(){"use strict";function e(e,n){var o={};return o.type=e,o.listenerCallback=n,o}function n(e,o,t){if("function"==typeof o)return void 0===s?s=0:s+=1,d[s]=o,new n(e,s,t);var a={};return a.name=e,a.callbackId=o,a.body=t,a}function o(e){if(void 0!==e&&null!==e){var n=d[e];return delete d[e],n}}function t(e){console.log("sendMessage: "+e),window.webkit.messageHandlers.POS.postMessage(e)}function a(){u.forEach(function(e){e.type===l.EventType.ConnectionEstablished&&e.listenerCallback()})}function r(e){var n=e.body;u.forEach(function(e){e.type===l.EventType.BarcodeScanned&&e.listenerCallback(n)})}function i(e){var n=o(e.callbackId);if(n){var t=e.body.result,a=e.body.error;n(t,a)}}function c(e){var n=o(e.callbackId);if(n){var t=e.body.success,a=e.body.error;n(t,a)}}var s,l={},d={},u=[],f={ConnectionEstablished:"ConnectionEstablished",GetLoginInformation:"GetLoginInformation",GetLoginInformationCallback:"GetLoginInformationCallback",PayBasket:"PayBasket",PayBasketCallback:"PayBasketCallback",BarcodeScanned:"BarcodeScanned"},b={Result:"result",Error:"error",Success:"success",LoginInformation:"loginInformation",Basket:"basket"},m={NotConnected:"No connection is established from the native POS application"};return l.receiveMessage=function(e){switch(console.log("receiveMessage: "+e),e.name){case f.ConnectionEstablished:a();break;case f.BarcodeScanned:r(e);break;case f.GetLoginInformationCallback:i(e);break;case f.PayBasketCallback:c(e);break;default:console.log("Unknown message name: "+e.name)}},l.LineItem=function(e,n,o,t,a,r,i,c){var s={};return s.name=e,s.quantity=n,s.unitPrice=o,s.vatPercentage=t,s.salesTaxPercentage=a,s.productId=r,s.imei=i,s.discounts=c,s},l.TransactionType={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Point:"Point"},l.Transaction=function(e,n){var o={};return o.transactionType=e,o.amount=n,o},l.Discount=function(e,n,o){var t={};return t.description=e,t.amount=n,t.percentage=o,t},l.Basket=function(e,n,o,t){var a={};return a.id=e,a.lineItems=n,a.transactions=o,a.discounts=t,a},l.LoginInformation=function(e,n,o,t,a,r){var i={};return i.shopId=e,i.shopName=n,i.registerId=o,i.registerName=t,i.userId=a,i.userName=r,i},l.EventType={ConnectionEstablished:"ConnectionEstablished",BarcodeScanned:"BarcodeScanned"},l.addEventListener=function(n,o){var t=[n,o];console.log("addEventListener: "+t.join(", ")),u.push(new e(n,o))},l.removeEventListener=function(e){console.log("removeEventListener: "+e),u.forEach(function(n,o){n.listenerCallback===e&&u.splice(o,1)})},l.isConnected=function(){return void 0!==window.webkit&&void 0!==window.webkit.messageHandlers&&void 0!==window.webkit.messageHandlers.POS},l.payBasket=function(e,o){var a=[e,o];if(console.log("payBasket: "+a.join(", ")),!l.isConnected())return void o(!1,m.NotConnected);var r={};r[b.Basket]=e;var i=new n(f.PayBasket,o,r);t(i)},l.getLoginInformation=function(e){if(console.log("getLoginInformation: "+e),!l.isConnected())return void e(null,m.NotConnected);var o=new n(f.GetLoginInformation,e);t(o)},l}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);