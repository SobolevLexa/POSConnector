var POSConnector=function(){"use strict";function e(e,n){var o={};return o.type=e,o.listenerCallback=n,o}function n(e,o,a){if("function"==typeof o)return void 0===l?l=0:l+=1,u[l]=o,new n(e,l,a);var t={};return t.name=e,t.callbackId=o,t.body=a,t}function o(e){if(void 0!==e&&null!==e){var n=u[e];return delete u[e],n}}function a(e){console.log("sendMessage: "+e),window.webkit.messageHandlers.POS.postMessage(e)}function t(){f.forEach(function(e){e.type===d.EventType.ConnectionEstablished&&e.listenerCallback()})}function r(e){var n=e.body;f.forEach(function(e){e.type===d.EventType.BarcodeScanned&&e.listenerCallback(n)})}function i(e){var n=o(e.callbackId);if(n){var a=e.body.result,t=e.body.error;n(a,t)}}function c(e){var n=o(e.callbackId);if(n){var a=e.body.success,t=e.body.error;n(a,t)}}function s(e){var n=o(e.callbackId);if(n){var a=e.body.error;n(a)}}var l,d={},u={},f=[],b={ConnectionEstablished:"ConnectionEstablished",GetLoginInformation:"GetLoginInformation",GetLoginInformationCallback:"GetLoginInformationCallback",PayBasket:"PayBasket",PayBasketCallback:"PayBasketCallback",BarcodeScanned:"BarcodeScanned",OpenURL:"OpenURL",OpenURLCallback:"OpenURLCallback"},v={Result:"result",Error:"error",Success:"success",LoginInformation:"loginInformation",Basket:"basket",URL:"url"},m={NotConnected:"No connection is established from the native POS application"};return d.receiveMessage=function(e){switch(console.log("receiveMessage: "+e),e.name){case b.ConnectionEstablished:t();break;case b.BarcodeScanned:r(e);break;case b.GetLoginInformationCallback:i(e);break;case b.PayBasketCallback:c(e);break;case b.OpenURLCallback:s(e);break;default:console.log("Unknown message name: "+e.name)}},d.LineItem=function(e,n,o,a,t,r,i,c){var s={};return s.name=e,s.quantity=n,s.unitPrice=o,s.vatPercentage=a,s.salesTaxPercentage=t,s.productId=r,s.imei=i,s.discounts=c,s},d.TransactionType={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Point:"Point"},d.Transaction=function(e,n){var o={};return o.transactionType=e,o.amount=n,o},d.Discount=function(e,n,o){var a={};return a.description=e,a.amount=n,a.percentage=o,a},d.Basket=function(e,n,o,a){var t={};return t.id=e,t.lineItems=n,t.transactions=o,t.discounts=a,t},d.LoginInformation=function(e,n,o,a,t,r){var i={};return i.shopId=e,i.shopName=n,i.registerId=o,i.registerName=a,i.userId=t,i.userName=r,i},d.EventType={ConnectionEstablished:"ConnectionEstablished",BarcodeScanned:"BarcodeScanned"},d.addEventListener=function(n,o){var a=[n,o];console.log("addEventListener: "+a.join(", ")),f.push(new e(n,o))},d.removeEventListener=function(e){console.log("removeEventListener: "+e),f.forEach(function(n,o){n.listenerCallback===e&&f.splice(o,1)})},d.isConnected=function(){return void 0!==window.webkit&&void 0!==window.webkit.messageHandlers&&void 0!==window.webkit.messageHandlers.POS},d.payBasket=function(e,o){var t=[e,o];if(console.log("payBasket: "+t.join(", ")),!d.isConnected())return void o(!1,m.NotConnected);var r={};r[v.Basket]=e;var i=new n(b.PayBasket,o,r);a(i)},d.getLoginInformation=function(e){if(console.log("getLoginInformation: "+e),!d.isConnected())return void e(null,m.NotConnected);var o=new n(b.GetLoginInformation,e);a(o)},d.openURL=function(e,o){var t=[e,o];console.log("openURL: "+t.join(", "));var r={};r[v.URL]=e;var i=new n(b.OpenURL,o,r);a(i)},d}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);