var POSConnector=function(){"use strict";function e(e,n){var t={};return t.type=e,t.listenerCallback=n,t}function n(e,t,a){if("function"==typeof t){var o=d;return b[o]=t,d+=1,new n(e,o,a)}var r={};return r.name=e,r.callbackId=t,r.body=a,r}function t(e,n){"function"==typeof e&&e.apply(void 0,n)}function a(e){var n=e.split("."),t=window,a=n.some(function(e){return t.hasOwnProperty(e)&&"object"==typeof t[e]?void(t=t[e]):!0});return a?"Invalid component(s) in object path: "+e:"function"!=typeof t.receiveMessage?"Invalid POSConnector object at the end of object path: "+e:void 0}function o(e){if(!l.isConnected())return"No connection is established from the native POS application";var n=a(e);return"string"==typeof n?n:void 0}function r(e){if("number"==typeof e){var n=b[e];return delete b[e],n}}function i(e){window.webkit.messageHandlers.POS.postMessage(e)}function c(e){var n=r(e.callbackId),a=e.body.result,o=e.body.error;t(n,[a,o])}function s(e){var n=r(e.callbackId),a=e.body.error;t(n,[a])}function u(e){var n=e.body;v.forEach(function(e){e.type===l.EventType.BarcodeScanned&&e.listenerCallback(n)})}var l={},f="POSConnector",d=0,b={},v=[],p={GetLoginInformation:"GetLoginInformation",GetLoginInformationCallback:"GetLoginInformationCallback",PayBasket:"PayBasket",PayBasketCallback:"PayBasketCallback",BarcodeScanned:"BarcodeScanned",OpenURL:"OpenURL",OpenURLCallback:"OpenURLCallback",PrintDocumentAtURL:"PrintDocumentAtURL",PrintDocumentWithData:"PrintDocumentWithData",PrintDocumentCallback:"PrintDocumentCallback",SendPOSConnectorObjectPathToPOS:"SendPOSConnectorObjectPathToPOS",SendPOSConnectorObjectPathToPOSCallback:"SendPOSConnectorObjectPathToPOSCallback"},P={Result:"result",Error:"error",Basket:"basket",URL:"url",Data:"data",ObjectPath:"objectPath"};l.receiveMessage=function(e){switch(e.name){case p.BarcodeScanned:u(e);break;case p.GetLoginInformationCallback:c(e);break;case p.PayBasketCallback:c(e);break;case p.OpenURLCallback:s(e);break;case p.PrintDocumentCallback:c(e);break;case p.SendPOSConnectorObjectPathToPOSCallback:s(e)}},l.LineItem=function(e,n,t,a,o,r,i,c){var s={};return s.name=e,s.quantity=n,s.unitPrice=t,s.vatPercentage=a,s.salesTaxPercentage=o,s.productId=r,s.imei=i,s.discounts=c,s};var m={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Point:"Point"};l.TransactionType=m,l.Transaction=function(e,n){var t={};return t.transactionType=e,t.amount=n,t},l.Discount=function(e,n,t){var a={};return a.description=e,a.amount=n,a.percentage=t,a},l.Basket=function(e,n,t,a){var o={};return o.id=e,o.lineItems=n,o.transactions=t,o.discounts=a,o},l.LoginInformation=function(e,n,t,a,o,r){var i={};return i.shopId=e,i.shopName=n,i.registerId=t,i.registerName=a,i.userId=o,i.userName=r,i};var y={BarcodeScanned:"BarcodeScanned"};return l.EventType=y,l.addEventListener=function(n,t){v.push(new e(n,t))},l.removeEventListener=function(e){v.forEach(function(n,t){n.listenerCallback===e&&v.splice(t,1)})},l.isConnected=function(){return"object"==typeof window.webkit&&"object"==typeof window.webkit.messageHandlers&&"object"==typeof window.webkit.messageHandlers.POS},l.payBasket=function(e,a){var r=o(f);if("string"==typeof r)return void t(a,[!1,r]);var c={};c[P.Basket]=e;var s=new n(p.PayBasket,a,c);i(s)},l.getLoginInformation=function(e){var a=o(f);if("string"==typeof a)return void t(e,[null,a]);var r=new n(p.GetLoginInformation,e);i(r)},l.openURL=function(e,a){var r=o(f);if("string"==typeof r)return void t(a,[r]);var c={};c[P.URL]=e;var s=new n(p.OpenURL,a,c);i(s)},l.printDocumentAtURL=function(e,a){var r=o(f);if("string"==typeof r)return void t(a,[!1,r]);var c={};c[P.URL]=e;var s=new n(p.PrintDocumentAtURL,a,c);i(s)},l.printDocumentWithData=function(e,a){var r=o(f);if("string"==typeof r)return void t(a,[r]);var c=function(e){var t={};t[P.Data]=e;var o=new n(p.PrintDocumentWithData,a,t);i(o)},s=typeof e;if("string"!==s&&"object"!==s&&t(a,[!1,"Data argument of invalid type: "+s]),"string"===s)return void c(e);if("object"!=typeof FileReader||"object"!=typeof Blob)return void t(a,[!1,"The required FileReader and/or Blob functionality isn't available in this Javascript environment"]);var u=new FileReader;u.onload=function(){var e=u.result,n=e.substr(e.indexOf(",")+1);c(n)},u.readAsDataURL(e)},l.sendPOSConnectorObjectPathToPOS=function(e,a){var r=o(e);if("string"==typeof r)return void t(a,[r]);var c=function(n){"string"==typeof n&&t(a,[n]),f=e,t(a)},s={};s[P.ObjectPath]=e;var u=new n(p.SendPOSConnectorObjectPathToPOS,c,s);i(u)},l}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);