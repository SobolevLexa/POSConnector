var POSConnector,POSConnectorClass;POSConnectorClass=function(){function e(){var e;this._bridge=null,e=this,this._connectWebViewJavascriptBridge(function(t){return e._bridge=t,e._bridge.init(function(){})})}return e.prototype.isConnected=function(){return null!=this._bridge},e.prototype.payBasket=function(e,t){return this._validateOrder(e).length||this._callHandler("payBasket",e),t?t(this._validateOrder(e)):void 0},e.prototype.subscribeForPaymentStatus=function(e){return this._registerHandler("paymentStatus",e)},e.prototype.subscribeForBarcodeScan=function(e){return this._registerHandler("barcodeScan",e)},e.prototype.subscribeForHomeButton=function(e){return this._registerHandler("goHome",e)},e.prototype.onConnect=function(e){return window.WebViewJavascriptBridge?e():document.addEventListener("WebViewJavascriptBridgeReady",function(){return e()})},e.prototype._connectWebViewJavascriptBridge=function(e){return window.WebViewJavascriptBridge?e(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){return e(WebViewJavascriptBridge)},!1)},e.prototype._sendMessage=function(e,t){return t?this._bridge.send(e,t):this._bridge.send(e)},e.prototype._registerHandler=function(e,t){return this._bridge.registerHandler(e,t)},e.prototype._callHandler=function(e,t){return this._bridge.callHandler(e,t)},e.prototype._validateOrder=function(e){var t,n,r,i,a,o,s,c,d,u,m,p,l,f,g,h,_,v,b,y;if(i=[],h=!1,o=function(e){var t;return t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/),t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0},c=function(e){return"number"==typeof e&&o(e)<=2},a=function(e,t){return i.push({errorCode:e,message:t})},e.id||a(1,"Order ID must be present"),(!e.order_line_items||e.order_line_items.length<1)&&a(2,"Order must containt at least 1 OrderLineItem"),e.order_line_items)for(_=e.order_line_items,s=0,p=_.length;p>s;s++)if(n=_[s],n.quantity&&n.quantity<0&&(h=!0),n.quantity&&0!==n.quantity||a(3,"Each OrderLineItem must contain a quantity different than 0"),n.unit_price&&c(n.unit_price)||a(4,"Each OrderLineItem must contain unit price with a maximum of 2 decimals"),n.product_id&&"string"==typeof n.product_id&&""!==n.product_id||a(5,"Each OrderLineItem must contain a name"),n.vat_percentage&&c(n.vat_percentage)&&n.vat_percentage>=0&&n.vat_percentage<=1||a(6,"Each OrderLineItem must contain a vat rate from 0 to 1 with a maximum of 2 decimals"),!n.imei||"string"==typeof n.imei&&""!==n.imei||a(7,"If imei is present on OrderLineItem, it must of type string and non empty"),n.unit_price&&n.unit_price<0&&a(8,"If UnitPrice is present on OrderLineItem, it cannot be negative"),n.discounts)for(v=n.discounts,d=0,l=v.length;l>d;d++)t=v[d],t.amount&&t.percentage&&a(9,"Both amount and percentage cannot be present on Discounts at the same time"),t.amount&&!c(t.amount)&&a(10,"If amount is present on discount, it must be a number with a maximum of 2 decimals"),!t.percentage||t.percentage>=0&&t.percentage<=1||a(11,"If percentage is present on Discount, it must be from 0 to 1"),!t.description||"string"==typeof t.description&&""!==t.description||a(12,"If description is present on Discount, it must be a non empty string");if(e.discounts)for(b=e.discounts,u=0,f=b.length;f>u;u++)t=b[u],t.amount&&t.percentage&&a(13,"Both amount and percentage cannot be present on Discounts at the same time"),t.amount&&!c(t.amount)&&a(14,"If amount is present on discount, it must be a number with a maximum of 2 decimals"),!t.percentage||t.percentage>=0&&t.percentage<=1||a(15,"If percentage is present on Discount, it must be from 0 to 1"),!t.description||"string"==typeof t.description&&""!==t.description||a(16,"If description is present on Discount, it must be a non empty string");if(e.transactions)for(y=e.transactions,m=0,g=y.length;g>m;m++)r=y[m],r.type&&"WM_TRANSACTION_TYPE_INSTALLMENT"===r.type||a(17,'Each transaction must contain type matching "WM_TRANSACTION_TYPE_INSTALLMENT"'),r.amount&&c(r.amount)||a(18,"Each transaction must contain amount with max 2 decimals");return e.transactions&&e.transactions.length&&h&&a(19,"If order has returns, transactions cannot exist on the order"),i},e.prototype.simulatePos=function(){var e,t,n,r,i,a,o,s,c,d,u,m,p,l,f,g,h,_,v;return o=void 0,p=[],c=[],a={},e="wvjbscheme",t="__WVJB_QUEUE_MESSAGE__",u={},l=1,f=function(n){return o=n.createElement("iframe"),o.style.display="none",o.src=e+"://"+t,n.documentElement.appendChild(o)},i=function(e){var t,n,r;if(console.info("[POS Simulator]: Started running..."),console.info("[POS Simulator]: Will echo Orders received from the payBasket() method, and send back Payment Status after 10 seconds of receiving and Order."),console.info("[POS Simulator]: Will also simulate Barcode Scans every 30 seconds."),console.info("[POS Simulator]: Remember to subscribe for Barcodes and Payment Status's with the methods provided."),WebViewJavascriptBridge._messageHandler)throw new Error("WebViewJavascriptBridge.init called twice");for(WebViewJavascriptBridge._messageHandler=e,n=c,c=null,t=0,setInterval(function(){return a.barcodeScan?a.barcodeScan({barcode:"1234567890123"}):void 0},3e4),r=[];t<n.length;)g(n[t]),r.push(t++);return r},m=function(e,t){return h({data:e},t)},d=function(e,t){return a[e]=t},n=function(e,t,n){return h({handlerName:e,data:t},n)},h=function(n,r){var i;return r&&(i="cb_"+l++ +"_"+(new Date).getTime(),u[i]=r,n.callbackId=i),p.push(n),o.src=e+"://"+t,n.handlerName?(console.log("[POS Simulator]: Received handler("+n.handlerName+") with data: ",n.data),console.log("[POS Simulator]: Invoking paymentStatus event in 10 seconds."),a.paymentStatus?setTimeout(function(){return a.paymentStatus({status:1,one_screen_order_id:n.data.id})},1e4):void 0):console.log("[POS Simulator]: Received message: ",n.data)},_=function(){var e;return e=JSON.stringify(p),p=[],e},g=function(e){var t;return setTimeout(t=function(){var t,n,r,i,o,s;if(i=JSON.parse(e),o=void 0,i.responseId){if(s=u[i.responseId],!s)return;return s(i.responseData),delete u[i.responseId]}s=void 0,i.callbackId&&(t=i.callbackId,s=function(e){return h({responseId:t,responseData:e})}),r=WebViewJavascriptBridge._messageHandler,i.handlerName&&(r=a[i.handlerName]);try{return r(i.data,s)}catch(c){if(n=c,"undefined"!=typeof console)return console.log("WebViewJavascriptBridge: WARNING: javascript handler threw.",i,n)}})},v=function(e){return c?c.push(e):g(e)},window.WebViewJavascriptBridge?void 0:(window.WebViewJavascriptBridge={init:i,send:m,registerHandler:d,callHandler:n,_fetchQueue:_,_handleMessageFromObjC:v},r=document,f(r),s=r.createEvent("Events"),s.initEvent("WebViewJavascriptBridgeReady",!0,!1),s.bridge=WebViewJavascriptBridge,r.dispatchEvent(s))},e}(),POSConnector=new POSConnectorClass;