var POSConnector=function(){"use strict";function e(e,n){var t={};return t.type=e,t.listenerCallback=n,t}function n(e,t,a){if("function"==typeof t)return void 0===i?i=0:i+=1,s[i]=t,new n(e,i,a);var o={};return o.name=e,o.callbackId=t,o.body=a,o}function t(e){if("number"==typeof e){var n=s[e];return delete s[e],n}}function a(e){window.webkit.messageHandlers.POS.postMessage(e)}function o(e){var n=t(e.callbackId);if("function"==typeof n){var a=e.body.result,o=e.body.error;n(a,o)}}function r(e){var n=t(e.callbackId);if("function"==typeof n){var a=e.body.error;n(a)}}function c(e){var n=e.body;l.forEach(function(e){e.type===u.EventType.BarcodeScanned&&e.listenerCallback(n)})}var i,u={},s={},l=[],d={GetLoginInformation:"GetLoginInformation",GetLoginInformationCallback:"GetLoginInformationCallback",PayBasket:"PayBasket",PayBasketCallback:"PayBasketCallback",BarcodeScanned:"BarcodeScanned",OpenURL:"OpenURL",OpenURLCallback:"OpenURLCallback",PrintDocumentAtURL:"PrintDocumentAtURL",PrintDocumentWithData:"PrintDocumentWithData",PrintDocumentCallback:"PrintDocumentCallback",SendPOSConnectorObjectPathToPOS:"SendPOSConnectorObjectPathToPOS",SendPOSConnectorObjectPathToPOSCallback:"SendPOSConnectorObjectPathToPOSCallback"},f={Result:"result",Error:"error",Basket:"basket",URL:"url",Data:"data",ObjectPath:"objectPath"},b={NotConnected:"No connection is established from the native POS application"};return u.receiveMessage=function(e){switch(e.name){case d.BarcodeScanned:c(e);break;case d.GetLoginInformationCallback:o(e);break;case d.PayBasketCallback:o(e);break;case d.OpenURLCallback:r(e);break;case d.PrintDocumentCallback:o(e);break;case d.SendPOSConnectorObjectPathToPOSCallback:r(e)}},u.LineItem=function(e,n,t,a,o,r,c,i){var u={};return u.name=e,u.quantity=n,u.unitPrice=t,u.vatPercentage=a,u.salesTaxPercentage=o,u.productId=r,u.imei=c,u.discounts=i,u},u.TransactionType={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Point:"Point"},u.Transaction=function(e,n){var t={};return t.transactionType=e,t.amount=n,t},u.Discount=function(e,n,t){var a={};return a.description=e,a.amount=n,a.percentage=t,a},u.Basket=function(e,n,t,a){var o={};return o.id=e,o.lineItems=n,o.transactions=t,o.discounts=a,o},u.LoginInformation=function(e,n,t,a,o,r){var c={};return c.shopId=e,c.shopName=n,c.registerId=t,c.registerName=a,c.userId=o,c.userName=r,c},u.EventType={BarcodeScanned:"BarcodeScanned"},u.addEventListener=function(n,t){l.push(new e(n,t))},u.removeEventListener=function(e){l.forEach(function(n,t){n.listenerCallback===e&&l.splice(t,1)})},u.isConnected=function(){return"object"==typeof window.webkit&&"object"==typeof window.webkit.messageHandlers&&"object"==typeof window.webkit.messageHandlers.POS},u.payBasket=function(e,t){if(!u.isConnected())return void t(!1,b.NotConnected);var o={};o[f.Basket]=e;var r=new n(d.PayBasket,t,o);a(r)},u.getLoginInformation=function(e){if(!u.isConnected())return void e(null,b.NotConnected);var t=new n(d.GetLoginInformation,e);a(t)},u.openURL=function(e,t){var o={};o[f.URL]=e;var r=new n(d.OpenURL,t,o);a(r)},u.printDocumentAtURL=function(e,t){var o={};o[f.URL]=e;var r=new n(d.PrintDocumentAtURL,t,o);a(r)},u.printDocumentWithData=function(e,t){if("object"!=typeof FileReader||"object"!=typeof Blob)return void t(!1,"The required Blob and/or FileReader functionality isn't available in this Javascript environment.");var o=new FileReader;o.onload=function(){var e=o.result,r=e.substr(e.indexOf(",")+1),c={};c[f.Data]=r;var i=new n(d.PrintDocumentWithData,t,c);a(i)},o.readAsDataURL(e)},u.sendPOSConnectorObjectPathToPOS=function(e,t){var o=e.split("."),r=window,c=o.some(function(e){return r.hasOwnProperty(e)&&"object"==typeof r[e]?void(r=r[e]):!0});if(c)return void("function"==typeof t&&t("Invalid component(s) in object path: "+e));if("function"!=typeof r.isConnected)return void("function"===t&&t("Invalid POSConnector object at the end of object path: "+e));var i={};i[f.ObjectPath]=e;var u=new n(d.SendPOSConnectorObjectPathToPOS,t,i);a(u)},u}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);